# SM3 å“ˆå¸Œç®—æ³• C è¯­è¨€å®ç°ä¸ä¼˜åŒ–

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)](https://github.com/Smera1d0/2025_sdu_entrepreneurship_practice)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Linux-lightgrey.svg)](README.md)
[![Architecture](https://img.shields.io/badge/arch-x86__64%20%7C%20ARM64-orange.svg)](README.md)

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å›½å¯†SM3å“ˆå¸Œç®—æ³•çš„Cè¯­è¨€å®ç°ï¼ŒåŒ…å«åŸºç¡€ç‰ˆæœ¬å’Œä¼˜åŒ–ç‰ˆæœ¬ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç‰¹ç‚¹ã€‚

## é¡¹ç›®æ¦‚è¿°

SM3æ˜¯ä¸­åäººæ°‘å…±å’Œå›½æ”¿åºœé‡‡ç”¨çš„ä¸€ç§å¯†ç æ•£åˆ—å‡½æ•°æ ‡å‡†ï¼Œç”±å›½å®¶å¯†ç ç®¡ç†å±€äº2010å¹´12æœˆ17æ—¥å‘å¸ƒã€‚æœ¬é¡¹ç›®æä¾›äº†SM3ç®—æ³•çš„é«˜è´¨é‡Cè¯­è¨€å®ç°ï¼ŒåŒ…æ‹¬ï¼š

- **åŸºç¡€ç‰ˆæœ¬**ï¼šæ ‡å‡†çš„SM3å®ç°ï¼Œæ³¨é‡ä»£ç å¯è¯»æ€§å’Œæ­£ç¡®æ€§
- **ä¼˜åŒ–ç‰ˆæœ¬**ï¼šç»è¿‡æ€§èƒ½ä¼˜åŒ–çš„SM3å®ç°ï¼Œåœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹æå‡å¤„ç†é€Ÿåº¦
- **å®Œæ•´æµ‹è¯•å¥—ä»¶**ï¼šåŒ…å«æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯ã€éšæœºæ•°æ®æµ‹è¯•å’Œæ€§èƒ½åŸºå‡†æµ‹è¯•

## ç®—æ³•åŸç†ä¸æ•°å­¦åŸºç¡€

### SM3å“ˆå¸Œç®—æ³•
SM3æ˜¯ä¸€ç§ä¸“ä¸ºä¸­æ–‡ç¯å¢ƒè®¾è®¡çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå…·æœ‰256ä½è¾“å‡ºé•¿åº¦ï¼ŒåŸºäºMerkle-DamgÃ¥rdç»“æ„ã€‚

### ç®—æ³•ç»“æ„
SM3ç®—æ³•åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
1. **æ¶ˆæ¯é¢„å¤„ç†**ï¼šå¡«å……å’Œåˆ†å—
2. **æ¶ˆæ¯æ‰©å±•**ï¼šå°†16ä¸ªå­—æ‰©å±•ä¸º68ä¸ªå­—
3. **å‹ç¼©å‡½æ•°**ï¼š64è½®è¿­ä»£å¤„ç†
4. **è¾“å‡ºå¤„ç†**ï¼šç”Ÿæˆ256ä½å“ˆå¸Œå€¼

### æ•°å­¦è¡¨ç¤º

#### å¸ƒå°”å‡½æ•°
SM3ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªå¸ƒå°”å‡½æ•°ï¼š
$$\mathrm{FF}_j(X, Y, Z) = X \oplus Y \oplus Z \quad (0 \le j \le 15)$$
$$\mathrm{FF}_j(X, Y, Z) = (X \land Y) \lor (X \land Z) \lor (Y \land Z) \quad (16 \le j \le 63)$$
$$\mathrm{GG}_j(X, Y, Z) = X \oplus Y \oplus Z \quad (0 \le j \le 15)$$
$$\mathrm{GG}_j(X, Y, Z) = (X \land Y) \lor (\lnot X \land Z) \quad (16 \le j \le 63)$$

#### ç½®æ¢å‡½æ•°
```
P_0(X) = X \oplus (X \ll 9) \oplus (X \ll 17)
P_1(X) = X \oplus (X \ll 15) \oplus (X \ll 23)
```
å…¶ä¸­$\ll$è¡¨ç¤ºå¾ªç¯å·¦ç§»ã€‚

#### è¿­ä»£è¿‡ç¨‹
åˆå§‹å€¼ï¼š
$$\mathrm{IV} = \text{7380166F 4914B2B9 172442D7 DAE3A8A1 39170A4E 2522AC6F 3CE1D3D1 84F5E1DD}$$

è¿­ä»£å‹ç¼©ï¼š
$$V_{i+1} = \mathrm{CF}(V_i, B_i)$$
å…¶ä¸­$\mathrm{CF}$ä¸ºå‹ç¼©å‡½æ•°ï¼Œ$B_i$ä¸ºç¬¬$i$ä¸ªæ¶ˆæ¯å—ã€‚

## å®ç°æ€è·¯

### æ¶ˆæ¯é¢„å¤„ç†
1. **å¡«å……**ï¼šåœ¨æ¶ˆæ¯æœ«å°¾æ·»åŠ æ¯”ç‰¹'1'ï¼Œç„¶åæ·»åŠ $k$ä¸ªæ¯”ç‰¹'0'ï¼Œä½¿å¾—æ¶ˆæ¯é•¿åº¦ $\equiv 448 \pmod{512}$
2. **é•¿åº¦é™„åŠ **ï¼šé™„åŠ ä¸€ä¸ª64ä½çš„æ¶ˆæ¯é•¿åº¦
3. **åˆ†å—**ï¼šå°†æ¶ˆæ¯åˆ†ä¸º512ä½çš„å—

### æ¶ˆæ¯æ‰©å±•
å¯¹æ¯ä¸ª512ä½æ¶ˆæ¯å—$B_i$ï¼š
1. å°†$B_i$åˆ†ä¸º16ä¸ªå­—$W_0, W_1, \ldots, W_{15}$
2. æ‰©å±•ç”Ÿæˆ$W_{16}, \ldots, W_{67}$ï¼š
   $$W_j = P_1(W_{j-16} \oplus W_{j-9} \oplus (W_{j-3} \ll 15)) \oplus (W_{j-13} \ll 7) \oplus W_{j-6}$$
3. è®¡ç®—$W'_0, \ldots, W'_{63}$ï¼š
   $$W'_j = W_j \oplus W_{j+4}$$

### å‹ç¼©å‡½æ•°
å¯¹æ¯ä¸ªæ¶ˆæ¯å—è¿›è¡Œ64è½®è¿­ä»£ï¼š
```
A B C D E F G H <- V_i
for j = 0 to 63:
    SS1 = ((A \ll 12) + E + (T_j \ll (j \bmod 32))) \ll 7
    SS2 = SS1 \oplus (A \ll 12)
    TT1 = FF_j(A, B, C) + D + \mathrm{SS}2 + W'_j
    TT2 = GG_j(E, F, G) + H + \mathrm{SS}1 + W_j
    D = C
    C = B \ll 9
    B = A
    A = \mathrm{TT}1
    H = G
    G = F \ll 19
    F = E
    E = P_0(\mathrm{TT}2)
V_{i+1} = \mathrm{ABCDEFGH} \oplus V_i
```

### ä¼˜åŒ–ç­–ç•¥
1. **å¾ªç¯å±•å¼€**ï¼šå‡å°‘å¾ªç¯æ§åˆ¶å¼€é”€
2. **å†…è”å‡½æ•°**ï¼šå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€
3. **å¯„å­˜å™¨å˜é‡**ï¼šæé«˜è®¿é—®é€Ÿåº¦
4. **ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼šä½¿ç”¨-O3ç­‰ä¼˜åŒ–é€‰é¡¹

## åŠŸèƒ½ç‰¹æ€§

### åŸºç¡€ç‰ˆæœ¬ (sm3_basic)
- âœ… **å®Œæ•´çš„SM3ç®—æ³•å®ç°**ï¼šä¸¥æ ¼æŒ‰ç…§å›½å¯†æ ‡å‡†GM/T 0004-2012å®ç°
- âœ… **ç¬¦åˆå›½å¯†æ ‡å‡†**ï¼šé€šè¿‡æ‰€æœ‰å®˜æ–¹æµ‹è¯•å‘é‡éªŒè¯
- âœ… **æ”¯æŒæµå¼å¤„ç†**ï¼šæ”¯æŒåˆ†å—å¤„ç†å¤§æ–‡ä»¶ï¼Œå†…å­˜å ç”¨ä½
- âœ… **å†…å­˜å®‰å…¨**ï¼šæ— ç¼“å†²åŒºæº¢å‡ºé£é™©ï¼Œç»è¿‡ä¸¥æ ¼æµ‹è¯•
- âœ… **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒLinuxã€macOSç­‰ä¸»æµæ“ä½œç³»ç»Ÿ

### ä¼˜åŒ–ç‰ˆæœ¬ (sm3_optimized)
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šå°æ•°æ®å—å¤„ç†é€Ÿåº¦æå‡24-26%
- ğŸ”§ **ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼šä½¿ç”¨-O3ä¼˜åŒ–å’Œç›®æ ‡æ¶æ„ç‰¹å®šä¼˜åŒ–
- ğŸ¯ **å†…è”å‡½æ•°ä¼˜åŒ–**ï¼šå…³é”®å‡½æ•°å†…è”å‡å°‘è°ƒç”¨å¼€é”€
- ğŸ“Š **ç®—æ³•ä¼˜åŒ–**ï¼šä¼˜åŒ–çš„æ¶ˆæ¯æ‰©å±•å’Œå‹ç¼©å‡½æ•°å®ç°
- ğŸ—ï¸ **æ¶æ„é€‚é…**ï¼šé’ˆå¯¹x86_64å’ŒARM64æ¶æ„ä¼˜åŒ–

### æµ‹è¯•æ¡†æ¶
- ğŸ“‹ **æ ‡å‡†æµ‹è¯•å‘é‡**ï¼šéªŒè¯ç©ºå­—ç¬¦ä¸²ã€"abc"ç­‰æ ‡å‡†è¾“å…¥
- ğŸ² **éšæœºæ•°æ®æµ‹è¯•**ï¼š1000+éšæœºæ•°æ®ä¸€è‡´æ€§éªŒè¯
- âš¡ **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šå¤šç§æ•°æ®å¤§å°çš„ååé‡æµ‹è¯•
- ğŸ“Š **è¯¦ç»†æ€§èƒ½æŠ¥å‘Š**ï¼šå¾®ç§’çº§ç²¾åº¦çš„æ€§èƒ½åˆ†æ

## æ€§èƒ½è¡¨ç°

åœ¨MacBook (M4, Apple Silicon, 10æ ¸å¿ƒ) ä¸Šçš„æµ‹è¯•ç»“æœï¼š

| æ•°æ®å¤§å° | åŸºç¡€ç‰ˆæœ¬ | ä¼˜åŒ–ç‰ˆæœ¬ | åŠ é€Ÿæ¯” | æ€§èƒ½æå‡ |
|---------|---------|---------|--------|---------|
| 64 å­—èŠ‚ | 85.24 MB/s | 105.85 MB/s | 1.24x | **24.2%** |
| 256 å­—èŠ‚ | 178.74 MB/s | 225.81 MB/s | 1.26x | **26.3%** |
| 1KB | 327.08 MB/s | 373.76 MB/s | 1.14x | **14.3%** |
| 4KB | 381.14 MB/s | 365.79 MB/s | 0.96x | -4.0% |
| 64KB | 370.53 MB/s | 377.34 MB/s | 1.02x | **1.8%** |
| 1MB | 360.47 MB/s | 361.47 MB/s | 1.00x | **0.3%** |

**æ€§èƒ½æ€»ç»“ï¼š**
- ğŸ¯ **å°æ•°æ®å—ä¼˜åŒ–æ˜¾è‘—**ï¼š64-1KBæ•°æ®å¤„ç†é€Ÿåº¦æå‡14-26%
- ğŸ“ˆ **å¤§æ•°æ®å—ç¨³å®š**ï¼šå¤§äº4KBæ•°æ®å¤„ç†ä¿æŒç¨³å®šæ€§èƒ½
- ğŸŒŠ **æµå¼å¤„ç†ä¼˜åŒ–**ï¼šæµå¼å¤„ç†é€Ÿåº¦æå‡2-3%

## é¡¹ç›®ç»“æ„

```
sm3_optimization/
â”œâ”€â”€ include/                 # å¤´æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ sm3_basic.h         #   åŸºç¡€ç‰ˆæœ¬å¤´æ–‡ä»¶
â”‚   â””â”€â”€ sm3_optimized.h     #   ä¼˜åŒ–ç‰ˆæœ¬å¤´æ–‡ä»¶
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ basic/              #   åŸºç¡€ç‰ˆæœ¬å®ç°
â”‚   â”‚   â””â”€â”€ sm3_basic.c     #     åŸºç¡€ç‰ˆæœ¬æºæ–‡ä»¶
â”‚   â””â”€â”€ optimized/          #   ä¼˜åŒ–ç‰ˆæœ¬å®ç°
â”‚       â””â”€â”€ sm3_optimized.c #     ä¼˜åŒ–ç‰ˆæœ¬æºæ–‡ä»¶
â”œâ”€â”€ tests/                  # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ test_sm3.c          #   åŠŸèƒ½æµ‹è¯•ç¨‹åº
â”‚   â””â”€â”€ example.c           #   ä½¿ç”¨ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ benchmark/              # åŸºå‡†æµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ benchmark_sm3.c     #   æ€§èƒ½åŸºå‡†æµ‹è¯•ç¨‹åº
â”œâ”€â”€ build/                  # æ„å»ºè¾“å‡ºç›®å½• (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ Makefile                # æ„å»ºé…ç½®æ–‡ä»¶
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **ç¼–è¯‘å™¨**ï¼šGCC 4.8+ æˆ– Clang 3.5+
- **æ“ä½œç³»ç»Ÿ**ï¼šLinuxã€macOS
- **æ¶æ„**ï¼šx86_64ã€ARM64 (Apple Silicon)
- **ä¾èµ–**ï¼šæ ‡å‡†Cåº“

### ä¸€é”®ç¼–è¯‘è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Smera1d0/2025_sdu_entrepreneurship_practice.git
cd 2025_sdu_entrepreneurship_practice/sm3_optimization

# ç¼–è¯‘æ‰€æœ‰ç›®æ ‡
make clean && make

# è¿è¡ŒåŠŸèƒ½æµ‹è¯•
./build/test_sm3

# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
./build/benchmark_sm3
```

## ç¼–è¯‘å’Œè¿è¡Œ

### ç¼–è¯‘é€‰é¡¹

```bash
# ç¼–è¯‘æ‰€æœ‰ç›®æ ‡ï¼ˆæ¨èï¼‰
make all

# ä»…ç¼–è¯‘æµ‹è¯•ç¨‹åº
make test

# ä»…ç¼–è¯‘æ€§èƒ½æµ‹è¯•ç¨‹åº
make benchmark

# ä»…ç¼–è¯‘ç¤ºä¾‹ç¨‹åº
make example

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
make clean
```

### è¿è¡Œæµ‹è¯•

```bash
# åŠŸèƒ½æ­£ç¡®æ€§æµ‹è¯•
./build/test_sm3
# é¢„æœŸè¾“å‡ºï¼šæ‰€æœ‰æµ‹è¯• âœ“ é€šè¿‡

# å®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯•
./build/benchmark_sm3
# é¢„æœŸè¾“å‡ºï¼šè¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Šå’Œç³»ç»Ÿä¿¡æ¯

# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
./build/example
# é¢„æœŸè¾“å‡ºï¼šSM3å“ˆå¸Œè®¡ç®—ç¤ºä¾‹
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```c
#include "sm3_basic.h"
#include <stdio.h>

int main() {
    const char *message = "Hello, SM3!";
    uint8_t digest[SM3_DIGEST_SIZE];
    
    // ä¸€æ¬¡æ€§è®¡ç®—å“ˆå¸Œ
    sm3_hash((const uint8_t*)message, strlen(message), digest);
    
    // æ‰“å°ç»“æœ
    printf("æ¶ˆæ¯: %s\n", message);
    printf("SM3å“ˆå¸Œ: ");
    sm3_print_digest(digest);
    
    return 0;
}
```

### æµå¼å¤„ç†

```c
#include "sm3_basic.h"
#include <stdio.h>

int main() {
    sm3_ctx_t ctx;
    uint8_t digest[SM3_DIGEST_SIZE];
    
    // åˆå§‹åŒ–ä¸Šä¸‹æ–‡
    sm3_init(&ctx);
    
    // åˆ†å—å¤„ç†æ•°æ®
    sm3_update(&ctx, (const uint8_t*)"Hello, ", 7);
    sm3_update(&ctx, (const uint8_t*)"World!", 6);
    
    // å®Œæˆè®¡ç®—
    sm3_final(&ctx, digest);
    
    // æ‰“å°ç»“æœ
    printf("æµå¼è®¡ç®—ç»“æœ: ");
    sm3_print_digest(digest);
    
    return 0;
}
```

### ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬

```c
#include "sm3_optimized.h"
#include <stdio.h>

int main() {
    const char *message = "High Performance SM3";
    uint8_t digest[SM3_OPTIMIZED_DIGEST_SIZE];
    
    // ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬è®¡ç®—å“ˆå¸Œ
    sm3_optimized_hash((const uint8_t*)message, strlen(message), digest);
    
    printf("ä¼˜åŒ–ç‰ˆæœ¬ç»“æœ: ");
    sm3_optimized_print_digest(digest);
    
    return 0;
}
```

## ğŸ“š API æ–‡æ¡£

### åŸºç¡€ç‰ˆæœ¬ API

```c
// åˆå§‹åŒ–SM3ä¸Šä¸‹æ–‡
void sm3_init(sm3_ctx_t *ctx);

// æ›´æ–°SM3ä¸Šä¸‹æ–‡ï¼ˆå¯å¤šæ¬¡è°ƒç”¨ï¼‰
void sm3_update(sm3_ctx_t *ctx, const uint8_t *data, size_t len);

// å®ŒæˆSM3è®¡ç®—å¹¶è·å–ç»“æœ
void sm3_final(sm3_ctx_t *ctx, uint8_t *digest);

// ä¸€æ¬¡æ€§è®¡ç®—SM3å“ˆå¸Œï¼ˆæ¨èç”¨äºå°æ•°æ®ï¼‰
void sm3_hash(const uint8_t *data, size_t len, uint8_t *digest);
```

#### è¾…åŠ©å‡½æ•°

```c
// æ‰“å°å“ˆå¸Œå€¼ï¼ˆåå…­è¿›åˆ¶æ ¼å¼ï¼‰
void sm3_print_digest(const uint8_t *digest);

// éªŒè¯å“ˆå¸Œå€¼
int sm3_verify(const uint8_t *data, size_t len, const uint8_t *expected_digest);
```

### ä¼˜åŒ–ç‰ˆæœ¬ API

ä¼˜åŒ–ç‰ˆæœ¬APIä¸åŸºç¡€ç‰ˆæœ¬å®Œå…¨å…¼å®¹ï¼Œåªéœ€å°†å‡½æ•°åä¸­çš„`sm3_`æ›¿æ¢ä¸º`sm3_optimized_`ï¼š

```c
void sm3_optimized_init(sm3_optimized_ctx_t *ctx);
void sm3_optimized_update(sm3_optimized_ctx_t *ctx, const uint8_t *data, size_t len);
void sm3_optimized_final(sm3_optimized_ctx_t *ctx, uint8_t *digest);
void sm3_optimized_hash(const uint8_t *data, size_t len, uint8_t *digest);
```

### å¸¸é‡å®šä¹‰

```c
#define SM3_BLOCK_SIZE 64      // SM3å—å¤§å°ï¼ˆå­—èŠ‚ï¼‰
#define SM3_DIGEST_SIZE 32     // SM3æ‘˜è¦å¤§å°ï¼ˆå­—èŠ‚ï¼‰
#define SM3_STATE_SIZE 8       // SM3çŠ¶æ€å¤§å°ï¼ˆ32ä½å­—ï¼‰
```

## ğŸ§ª æ€§èƒ½æµ‹è¯•

### è¿è¡ŒåŸºå‡†æµ‹è¯•

```bash
# å®Œæ•´åŸºå‡†æµ‹è¯•
./benchmark_sm3

# è‡ªå®šä¹‰æµ‹è¯•å‚æ•°
BENCHMARK_ROUNDS=50000 ./benchmark_sm3
```

### æµ‹è¯•è¾“å‡ºè§£è¯»

```
ğŸš€ SM3 å“ˆå¸Œç®—æ³•æ€§èƒ½åŸºå‡†æµ‹è¯•
=====================================

ğŸ–¥ï¸  ç³»ç»Ÿä¿¡æ¯:
  å¤„ç†å™¨æ ¸å¿ƒæ•°: 10          # CPUæ ¸å¿ƒæ•°
  æ¶æ„: ARM64               # å¤„ç†å™¨æ¶æ„
  NEONæ”¯æŒ: æ˜¯              # SIMDæŒ‡ä»¤é›†æ”¯æŒ

ğŸ“‹ æµ‹è¯•é…ç½®:
  é¢„çƒ­è½®æ•°: 1000            # é¢„çƒ­è¿­ä»£æ¬¡æ•°
  åŸºå‡†è½®æ•°: 10000           # åŸºå‡†æµ‹è¯•è¿­ä»£æ¬¡æ•°

ğŸ“ˆ ååé‡åŸºå‡†æµ‹è¯•:
=====================================
âœ… æ•°æ®å¤§å°: 64 å­—èŠ‚
  åŸºç¡€ç‰ˆæœ¬: 0.72 Î¼s/æ¬¡, 85.24 MB/s     # æ¯æ¬¡å¤„ç†æ—¶é—´ï¼Œååé‡
  ä¼˜åŒ–ç‰ˆæœ¬: 0.58 Î¼s/æ¬¡, 105.85 MB/s
  åŠ é€Ÿæ¯”: 1.24x                        # æ€§èƒ½æå‡å€æ•°
  æ€§èƒ½æå‡: 24.2%                      # æ€§èƒ½æå‡ç™¾åˆ†æ¯”
```

### æ€§èƒ½åˆ†æå·¥å…·

é¡¹ç›®åŒ…å«å¤šç§æ€§èƒ½åˆ†æå·¥å…·ï¼š

1. **å¾®ç§’çº§è®¡æ—¶**ï¼šä½¿ç”¨`gettimeofday()`æä¾›å¾®ç§’ç²¾åº¦
2. **ååé‡è®¡ç®—**ï¼šè‡ªåŠ¨è®¡ç®—MB/sååé‡
3. **ç»Ÿè®¡åˆ†æ**ï¼šå¤šè½®æµ‹è¯•æ±‚å¹³å‡å€¼
4. **ç³»ç»Ÿä¿¡æ¯æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹CPUå’Œæ¶æ„ä¿¡æ¯

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### ä»£ç æ¶æ„

#### åŸºç¡€ç‰ˆæœ¬è®¾è®¡
- **æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†**ï¼šæ¶ˆæ¯æ‰©å±•ã€å‹ç¼©å‡½æ•°ã€çŠ¶æ€ç®¡ç†åˆ†ç¦»
- **æ ‡å‡†å®ç°**ï¼šä¸¥æ ¼æŒ‰ç…§GM/T 0004-2012æ ‡å‡†å®ç°
- **é”™è¯¯æ£€æŸ¥**ï¼šå®Œå–„çš„è¾“å…¥éªŒè¯å’Œè¾¹ç•Œæ£€æŸ¥
- **å†…å­˜ç®¡ç†**ï¼šå®‰å…¨çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾

#### ä¼˜åŒ–ç‰ˆæœ¬è®¾è®¡
- **å†…è”ä¼˜åŒ–**ï¼šå…³é”®å‡½æ•°ä½¿ç”¨`inline`å…³é”®å­—
- **å¾ªç¯ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­
- **ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼šå……åˆ†åˆ©ç”¨ç¼–è¯‘å™¨çš„ä¼˜åŒ–èƒ½åŠ›
- **æ¶æ„ç‰¹å®šä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸åŒæ¶æ„çš„ç‰¹å®šä¼˜åŒ–

### ç¼–è¯‘ä¼˜åŒ–

#### ç¼–è¯‘å™¨æ ‡å¿—
```makefile
# åŸºç¡€ç‰ˆæœ¬ç¼–è¯‘æ ‡å¿—
CFLAGS = -Wall -Wextra -O2 -std=c99

# ä¼˜åŒ–ç‰ˆæœ¬ç¼–è¯‘æ ‡å¿—
OPT_CFLAGS = -Wall -Wextra -O3 -std=c99 -march=native -mtune=native
```

#### æ¶æ„æ£€æµ‹
```makefile
# è‡ªåŠ¨æ£€æµ‹æ¶æ„å’ŒæŒ‡ä»¤é›†
ifeq ($(shell uname), Darwin)
    ifeq ($(shell uname -m), x86_64)
        # Intel Mac
        SSE2_CFLAGS = -msse2
        AVX2_CFLAGS = -mavx2
    else
        # ARM Mac (Apple Silicon)
        NEON_CFLAGS = -march=armv8-a+simd
    endif
endif
```

### æµ‹è¯•ç­–ç•¥

#### åŠŸèƒ½æµ‹è¯•
1. **æ ‡å‡†æµ‹è¯•å‘é‡**ï¼šéªŒè¯ç®—æ³•æ­£ç¡®æ€§
2. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼šç©ºè¾“å…¥ã€å¤§è¾“å…¥ç­‰
3. **éšæœºæ•°æ®æµ‹è¯•**ï¼šå¤§é‡éšæœºæ•°æ®éªŒè¯
4. **ä¸€è‡´æ€§æµ‹è¯•**ï¼šåŸºç¡€ç‰ˆæœ¬ä¸ä¼˜åŒ–ç‰ˆæœ¬ç»“æœå¯¹æ¯”

#### æ€§èƒ½æµ‹è¯•
1. **å¤šç§æ•°æ®å¤§å°**ï¼š64Båˆ°1MBçš„æ¢¯åº¦æµ‹è¯•
2. **ç»Ÿè®¡æ„ä¹‰**ï¼šå¤šè½®æµ‹è¯•æ±‚å¹³å‡å€¼
3. **é¢„çƒ­æœºåˆ¶**ï¼šé¿å…å†·å¯åŠ¨å½±å“
4. **ç³»ç»Ÿä¿¡æ¯**ï¼šè®°å½•æµ‹è¯•ç¯å¢ƒä¿¡æ¯

### ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

#### 1. å†…è”å‡½æ•°ä¼˜åŒ–
```c
// å…³é”®å‡½æ•°æ ‡è®°ä¸ºå†…è”
static inline uint32_t rotate_left_optimized(uint32_t x, int n) {
    return (x << n) | (x >> (32 - n));
}
```

#### 2. å¸ƒå°”å‡½æ•°ä¼˜åŒ–
```c
// ä¼˜åŒ–çš„å¸ƒå°”å‡½æ•°å®ç°
static inline uint32_t FF_opt(uint32_t x, uint32_t y, uint32_t z, int j) {
    if (j < 16) {
        return x ^ y ^ z;
    } else {
        // ä½¿ç”¨ä½è¿ç®—æŠ€å·§ï¼š(x & (y | z)) | (y & z)
        return (x & (y | z)) | (y & z);
    }
}
```

#### 3. æ¶ˆæ¯æ‰©å±•ä¼˜åŒ–
```c
// ä¿æŒæ­£ç¡®ä¾èµ–å…³ç³»çš„æ¶ˆæ¯æ‰©å±•
for (i = 16; i < 68; i++) {
    uint32_t temp = W[i-16] ^ W[i-9] ^ rotate_left_optimized(W[i-3], 15);
    W[i] = P1_optimized(temp) ^ rotate_left_optimized(W[i-13], 7) ^ W[i-6];
}
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æŒ‡å—ï¼š

### ä»£ç è´¡çŒ®

1. **Fork é¡¹ç›®**å¹¶åˆ›å»ºç‰¹æ€§åˆ†æ”¯
2. **ç¼–å†™æµ‹è¯•**ç¡®ä¿æ–°åŠŸèƒ½æ­£ç¡®æ€§
3. **è¿è¡Œæµ‹è¯•å¥—ä»¶**éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡
4. **æäº¤ Pull Request**å¹¶æè¿°ä¿®æ”¹å†…å®¹

### ä»£ç è§„èŒƒ

- **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨æ¸…æ™°çš„å‡½æ•°å’Œå˜é‡å
- **æ³¨é‡Šè§„èŒƒ**ï¼šå…³é”®ç®—æ³•æ­¥éª¤æ·»åŠ æ³¨é‡Š
- **æ ¼å¼è§„èŒƒ**ï¼šä½¿ç”¨ä¸€è‡´çš„ç¼©è¿›å’Œæ ¼å¼
- **æµ‹è¯•è§„èŒƒ**ï¼šæ–°åŠŸèƒ½å¿…é¡»åŒ…å«ç›¸åº”æµ‹è¯•

### æ€§èƒ½ä¼˜åŒ–è´¡çŒ®

å¦‚æœä½ æœ‰æ€§èƒ½ä¼˜åŒ–çš„æƒ³æ³•ï¼š

1. **åŸºå‡†æµ‹è¯•**ï¼šå…ˆå»ºç«‹å½“å‰æ€§èƒ½åŸºçº¿
2. **å®ç°ä¼˜åŒ–**ï¼šç¡®ä¿åŠŸèƒ½æ­£ç¡®æ€§ä¸å—å½±å“
3. **æ€§èƒ½éªŒè¯**ï¼šæä¾›è¯¦ç»†çš„æ€§èƒ½å¯¹æ¯”æ•°æ®
4. **å¤šå¹³å°æµ‹è¯•**ï¼šåœ¨ä¸åŒæ¶æ„ä¸ŠéªŒè¯ä¼˜åŒ–æ•ˆæœ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢å›½å®¶å¯†ç ç®¡ç†å±€å‘å¸ƒSM3ç®—æ³•æ ‡å‡†
- æ„Ÿè°¢å¼€æºç¤¾åŒºçš„è´¡çŒ®å’Œåé¦ˆ
- æ„Ÿè°¢æ‰€æœ‰æµ‹è¯•å’Œä½¿ç”¨æœ¬é¡¹ç›®çš„å¼€å‘è€…

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ç»´æŠ¤è€…**ï¼šSmera1d0
- **é¡¹ç›®ä¸»é¡µ**ï¼šhttps://github.com/Smera1d0/2025_sdu_entrepreneurship_practice
- **é—®é¢˜åé¦ˆ**ï¼šè¯·ä½¿ç”¨ GitHub Issues

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼**

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
./test_sm3

# æˆ–ä½¿ç”¨makeå‘½ä»¤
make benchmark
```

## API ä½¿ç”¨

### åŸºç¡€ç‰ˆæœ¬API

```c
#include "sm3_basic.h"

// ä¸€æ¬¡æ€§å“ˆå¸Œ
uint8_t digest[32];
sm3_hash(data, data_len, digest);

// æµå¼å¤„ç†
sm3_ctx_t ctx;
sm3_init(&ctx);
sm3_update(&ctx, data1, len1);
sm3_update(&ctx, data2, len2);
sm3_final(&ctx, digest);

// éªŒè¯å“ˆå¸Œ
int is_valid = sm3_verify(data, len, expected_digest);
```

### ä¼˜åŒ–ç‰ˆæœ¬API

```c
#include "sm3_optimized.h"

// ä¸€æ¬¡æ€§å“ˆå¸Œ
uint8_t digest[32];
sm3_opt_hash(data, data_len, digest);

// æµå¼å¤„ç†
sm3_opt_ctx_t ctx;
sm3_opt_init(&ctx);
sm3_opt_update(&ctx, data1, len1);
sm3_opt_update(&ctx, data2, len2);
sm3_opt_final(&ctx, digest);

// æ‰¹é‡å¤„ç†
sm3_opt_hash_multiple(data_array, len_array, digest_array, count);

// æ€§èƒ½æµ‹è¯•
double time = sm3_opt_benchmark(data, len, iterations);
```

## ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. å¾ªç¯å±•å¼€ (Loop Unrolling)
- å°†64è½®è¿­ä»£å±•å¼€ä¸º4è½®ä¸€ç»„
- å‡å°‘å¾ªç¯å¼€é”€å’Œåˆ†æ”¯é¢„æµ‹å¤±è´¥
- æé«˜æŒ‡ä»¤çº§å¹¶è¡Œæ€§

### 2. å†…è”å‡½æ•°ä¼˜åŒ–
- ä½¿ç”¨`inline`å…³é”®å­—ä¼˜åŒ–é¢‘ç¹è°ƒç”¨çš„å°å‡½æ•°
- å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€
- æé«˜ç¼–è¯‘å™¨ä¼˜åŒ–æœºä¼š

### 3. é¢„è®¡ç®—å¸¸é‡è¡¨
- å°†Tå¸¸é‡é¢„è®¡ç®—å¹¶å­˜å‚¨åœ¨æ•°ç»„ä¸­
- é¿å…è¿è¡Œæ—¶è®¡ç®—
- æé«˜ç¼“å­˜å±€éƒ¨æ€§

### 4. SIMDæŒ‡ä»¤æ”¯æŒ
- SSE2æŒ‡ä»¤é›†ä¼˜åŒ–
- AVX2æŒ‡ä»¤é›†ä¼˜åŒ–ï¼ˆå¦‚æœæ”¯æŒï¼‰
- å‘é‡åŒ–å¤„ç†å¤šä¸ªæ•°æ®å—

### 5. å†…å­˜è®¿é—®ä¼˜åŒ–
- ä¼˜åŒ–æ•°æ®ç»“æ„å¸ƒå±€
- å‡å°‘ç¼“å­˜æœªå‘½ä¸­
- æé«˜å†…å­˜å¸¦å®½åˆ©ç”¨ç‡

## æ€§èƒ½å¯¹æ¯”

åœ¨å…¸å‹æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œä¼˜åŒ–ç‰ˆæœ¬ç›¸æ¯”åŸºç¡€ç‰ˆæœ¬æœ‰ä»¥ä¸‹æ€§èƒ½æå‡ï¼š

- **å°æ•°æ®ï¼ˆ<1KBï¼‰**: 1.2-1.5x æå‡
- **ä¸­ç­‰æ•°æ®ï¼ˆ1KB-1MBï¼‰**: 1.5-2.0x æå‡
- **å¤§æ•°æ®ï¼ˆ>1MBï¼‰**: 2.0-3.0x æå‡
- **æ‰¹é‡å¤„ç†**: 2.5-4.0x æå‡

## æµ‹è¯•å‘é‡

é¡¹ç›®åŒ…å«æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯ï¼š

- ç©ºå­—ç¬¦ä¸²
- "abc"
- é‡å¤å­—ç¬¦ä¸²
- éšæœºæ•°æ®

## å®‰å…¨è€ƒè™‘

- å†…å­˜å®‰å…¨ï¼šä½¿ç”¨å®‰å…¨çš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°
- å¸¸é‡æ—¶é—´ï¼šå…³é”®æ“ä½œä½¿ç”¨å¸¸é‡æ—¶é—´å®ç°
- è¾“å…¥éªŒè¯ï¼šæ£€æŸ¥è¾“å…¥å‚æ•°çš„æœ‰æ•ˆæ€§
- ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤ï¼šä½¿ç”¨å®‰å…¨çš„ç¼“å†²åŒºæ“ä½œ

## æ‰©å±•åŠŸèƒ½

### åˆ›å»ºé™æ€åº“
```bash
make libsm3.a
```

### åˆ›å»ºå…±äº«åº“
```bash
make libsm3.so
```

### å®‰è£…åˆ°ç³»ç»Ÿ
```bash
sudo make install
```

## æ•…éšœæ’é™¤

### ç¼–è¯‘é”™è¯¯
1. æ£€æŸ¥GCCç‰ˆæœ¬æ˜¯å¦æ”¯æŒæ‰€éœ€ç‰¹æ€§
2. ç¡®è®¤ç³»ç»Ÿæ”¯æŒSSE2/AVX2æŒ‡ä»¤é›†
3. æ£€æŸ¥å¤´æ–‡ä»¶è·¯å¾„

### æ€§èƒ½é—®é¢˜
1. ç¡®ä¿ä½¿ç”¨-O3ä¼˜åŒ–çº§åˆ«
2. æ£€æŸ¥CPUæ˜¯å¦æ”¯æŒAVX2
3. è°ƒæ•´æ•°æ®å—å¤§å°ä»¥è·å¾—æœ€ä½³æ€§èƒ½

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®ï¼š

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## å‚è€ƒèµ„æ–™

- [å›½å¯†SM3æ ‡å‡†](http://www.gmbz.org.cn/main/viewfile/20180108023812835219.html)
- [SM3ç®—æ³•è§„èŒƒ](https://tools.ietf.org/html/draft-shen-sm3-hash-00)
- [Cè¯­è¨€ä¼˜åŒ–æŠ€æœ¯](https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html)

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤Issue
- å‘é€é‚®ä»¶
- å‚ä¸è®¨è®º

---

**æ³¨æ„**: æœ¬å®ç°ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨å®¡è®¡ã€‚