# Poseidon2å“ˆå¸Œé›¶çŸ¥è¯†è¯æ˜ç”µè·¯

æœ¬é¡¹ç›®ä½¿ç”¨circomå®ç°äº†Poseidon2å“ˆå¸Œç®—æ³•çš„é›¶çŸ¥è¯†è¯æ˜ç”µè·¯ï¼Œæ”¯æŒGroth16è¯æ˜ç³»ç»Ÿã€‚ç”¨æˆ·å¯ä»¥è¯æ˜è‡ªå·±çŸ¥é“æŸä¸ªå“ˆå¸Œå€¼çš„åŸè±¡ï¼Œè€Œæ— éœ€æ³„éœ²åŸè±¡æœ¬èº«ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

- **ç®—æ³•**: Poseidon2å“ˆå¸Œç®—æ³•ï¼ˆ5è½®ç®€åŒ–ç‰ˆï¼‰
- **å‚æ•°**: (n,t,d) = (256,3,5)
  - n: å­—æ®µå¤§å° (256ä½)
  - t: çŠ¶æ€å¤§å° (3ä¸ªå…ƒç´ )
  - d: è½®æ•° (5è½®)
- **è¯æ˜ç³»ç»Ÿ**: Groth16
- **è¾“å…¥**: 256ä½å“ˆå¸ŒåŸè±¡ï¼ˆéšç§è¾“å…¥ï¼‰
- **è¾“å‡º**: 256ä½å“ˆå¸Œå€¼ï¼ˆå…¬å¼€è¾“å…¥ï¼‰

## ğŸ“ é¡¹ç›®ç»“æ„

```
circom_poseidon2_hash/
â”œâ”€â”€ poseidon2.circom             # Poseidon2å“ˆå¸Œç®—æ³•æ ¸å¿ƒå®ç°
â”œâ”€â”€ poseidon2_hash.circom        # ä¸»ç”µè·¯æ–‡ä»¶
â”œâ”€â”€ calculate_hash.js            # å“ˆå¸Œå€¼è®¡ç®—è„šæœ¬
â”œâ”€â”€ generate_proof.js            # è¯æ˜ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ package.json                 # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶/
    â”œâ”€â”€ poseidon2_hash.r1cs      # R1CSçº¦æŸç³»ç»Ÿ
    â”œâ”€â”€ poseidon2_hash.wasm      # WebAssemblyæ–‡ä»¶
    â”œâ”€â”€ poseidon2_hash.sym       # ç¬¦å·è¡¨æ–‡ä»¶
    â”œâ”€â”€ poseidon2_hash_js/       # JavaScriptç”Ÿæˆæ–‡ä»¶
    â””â”€â”€ poseidon2_hash_cpp/      # C++ç”Ÿæˆæ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js (ç‰ˆæœ¬ >= 16)
- npm æˆ– yarn
- circom (ç‰ˆæœ¬ >= 2.1.4)
- snarkjs

### 2. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Smera1d0/2025_sdu_entrepreneurship_practice.git
cd circom_poseidon2_hash

# å®‰è£…ä¾èµ–
npm install
```

### 3. ç¼–è¯‘ç”µè·¯

```bash
npm run compile
```

è¿™å°†ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š
- `poseidon2_hash.r1cs`: R1CSçº¦æŸç³»ç»Ÿ
- `poseidon2_hash.wasm`: WebAssemblyæ–‡ä»¶
- `poseidon2_hash.sym`: ç¬¦å·è¡¨æ–‡ä»¶

### 4. è®¾ç½®å¯ä¿¡è®¾ç½®

```bash
# ä¸‹è½½å¯ä¿¡è®¾ç½®æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
wget https://zkrepl.dev/powersOfTau28_hez_final_12.ptau

# ç”Ÿæˆåˆå§‹zkey
npm run setup

# è´¡çŒ®éšæœºæ€§
npm run contribute

# å¯¼å‡ºéªŒè¯å¯†é’¥
npm run export-verifier
```

### 5. è®¡ç®—å“ˆå¸Œå€¼

```bash
npm run calculate-hash
```

è¿™ä¼šè¿è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè®¡ç®—Poseidon2å“ˆå¸Œå€¼å¹¶ä¿å­˜åˆ°æ–‡ä»¶ã€‚

### 6. ç”Ÿæˆè¯æ˜

```bash
npm run generate-proof
```

### 7. éªŒè¯è¯æ˜

```bash
npm run verify-proof
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨æ–¹æ³•

### æ‰‹åŠ¨è®¡ç®—å“ˆå¸Œå€¼

```bash
npm run calculate-hash
```

è„šæœ¬ä¼šè®¡ç®—ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹çš„å“ˆå¸Œå€¼ï¼š
- ç®€å•æµ‹è¯•: ["123", "456"]
- é›¶å€¼æµ‹è¯•: ["0", "0"]  
- å¤§æ•°æµ‹è¯•: ["999999999", "888888888"]

è®¡ç®—ç»“æœä¼šä¿å­˜åˆ°å¯¹åº”çš„JSONæ–‡ä»¶ä¸­ã€‚

### è‡ªå®šä¹‰è¾“å…¥

ä½ å¯ä»¥ä¿®æ”¹ `generate_proof.js` ä¸­çš„è¾“å…¥æ•°æ®ï¼š

```javascript
const input = {
    preimage: ["ä½ çš„è¾“å…¥1", "ä½ çš„è¾“å…¥2"]
};
```

### æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶

- `input.json`: è¾“å…¥æ•°æ®ï¼ˆåŸè±¡å’Œå“ˆå¸Œå€¼ï¼‰
- `proof.json`: Groth16è¯æ˜
- `public.json`: å…¬å¼€ä¿¡å·
- `verification_key.json`: éªŒè¯å¯†é’¥

## ğŸ”§ æŠ€æœ¯å®ç°

### ç”µè·¯è®¾è®¡

#### ä¸»ç”µè·¯ (poseidon2_hash.circom)

```circom
template Poseidon2Hash() {
    signal input hash[2];      // å…¬å¼€è¾“å…¥ï¼š256ä½å“ˆå¸Œå€¼
    signal input preimage[2];  // éšç§è¾“å…¥ï¼š256ä½åŸè±¡
    
    component hasher = Poseidon2();
    
    hasher.in[0] <== preimage[0];
    hasher.in[1] <== preimage[1];
    
    hasher.out[0] === hash[0];
    hasher.out[1] === hash[1];
}
```

#### Poseidon2å®ç° (poseidon2.circom)

å®ç°äº†5è½®Poseidon2å“ˆå¸Œç®—æ³•ï¼ŒåŒ…æ‹¬ï¼š
- çŠ¶æ€åˆå§‹åŒ–ï¼ˆ3ä¸ªå…ƒç´ ï¼‰
- 5è½®è¿­ä»£ï¼Œæ¯è½®åŒ…å«ï¼š
  - è½®å¸¸æ•°æ·»åŠ 
  - S-boxå˜æ¢ (x^5)
  - MDSçŸ©é˜µä¹˜æ³•
- è¾“å‡ºå‰ä¸¤ä¸ªçŠ¶æ€å…ƒç´ ä½œä¸º256ä½å“ˆå¸Œå€¼

### å“ˆå¸Œè®¡ç®—è„šæœ¬

`calculate_hash.js` æä¾›äº†ä¸circomç”µè·¯å®Œå…¨ä¸€è‡´çš„JavaScriptå®ç°ï¼š

- ä½¿ç”¨ç›¸åŒçš„æœ‰é™å­—æ®µç®—æœ¯
- å®ç°ç›¸åŒçš„5è½®Poseidon2ç®—æ³•
- æ”¯æŒBigIntå¤§æ•°è¿ç®—
- æä¾›è¯¦ç»†çš„ä¸­é—´æ­¥éª¤è¾“å‡º

### è¯æ˜ç”Ÿæˆæµç¨‹

1. **è¾“å…¥å‡†å¤‡**: ä½¿ç”¨å“ˆå¸Œè®¡ç®—è„šæœ¬ç”Ÿæˆæ­£ç¡®çš„å“ˆå¸Œå€¼
2. **ç”µè·¯ç¼–è¯‘**: ç”ŸæˆR1CSçº¦æŸå’ŒWASMæ–‡ä»¶
3. **å¯ä¿¡è®¾ç½®**: ç”Ÿæˆå’Œè´¡çŒ®zkey
4. **è¯æ˜ç”Ÿæˆ**: ä½¿ç”¨Groth16ç®—æ³•ç”Ÿæˆè¯æ˜
5. **è¯æ˜éªŒè¯**: éªŒè¯è¯æ˜çš„æœ‰æ•ˆæ€§

## ğŸ“Š æ€§èƒ½å‚æ•°

- **çº¦æŸæ•°é‡**: çº¦150ä¸ªçº¦æŸ
- **è¯æ˜å¤§å°**: ~2KB
- **éªŒè¯æ—¶é—´**: <1ms
- **ç”Ÿæˆæ—¶é—´**: å–å†³äºè¾“å…¥å¤æ‚åº¦

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **è½®æ•°**: å½“å‰ä½¿ç”¨5è½®ï¼Œé€‚ç”¨äºæ¼”ç¤ºå’Œå­¦ä¹ 
2. **å‚æ•°**: ä½¿ç”¨ç®€åŒ–çš„è½®å¸¸æ•°å’ŒMDSçŸ©é˜µ
3. **å­—æ®µ**: ä½¿ç”¨circomé»˜è®¤çš„BN254æ›²çº¿
4. **å¯ä¿¡è®¾ç½®**: ä½¿ç”¨å…¬å¼€çš„å¯ä¿¡è®¾ç½®æ–‡ä»¶

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰éœ€è¦ï¼š
- å¢åŠ è½®æ•°åˆ°æ ‡å‡†å€¼ï¼ˆå¦‚72è½®ï¼‰
- ä½¿ç”¨å®Œæ•´çš„è½®å¸¸æ•°è¡¨
- ä½¿ç”¨å®Œæ•´çš„MDSçŸ©é˜µ
- è¿›è¡Œç‹¬ç«‹çš„å®‰å…¨å®¡è®¡

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä¿®æ”¹è½®æ•°

è¦ä¿®æ”¹è½®æ•°ï¼Œéœ€è¦ï¼š
1. åœ¨ `poseidon2.circom` ä¸­å±•å¼€æ›´å¤šè½®
2. åœ¨ `calculate_hash.js` ä¸­ä¿®æ”¹å¾ªç¯æ¬¡æ•°
3. é‡æ–°ç¼–è¯‘ç”µè·¯

### ä¿®æ”¹çŠ¶æ€å¤§å°

è¦æ”¯æŒä¸åŒçš„çŠ¶æ€å¤§å°ï¼š
1. ä¿®æ”¹çŠ¶æ€æ•°ç»„å¤§å°
2. è°ƒæ•´MDSçŸ©é˜µç»´åº¦
3. æ›´æ–°å“ˆå¸Œè®¡ç®—è„šæœ¬

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ç”µè·¯ä¸­æ·»åŠ æ–°çš„çº¦æŸ
2. æ›´æ–°å“ˆå¸Œè®¡ç®—è„šæœ¬
3. ä¿®æ”¹è¯æ˜ç”Ÿæˆè„šæœ¬
4. æ›´æ–°æµ‹è¯•ç”¨ä¾‹

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**: ç¡®ä¿circomç‰ˆæœ¬ >= 2.1.4
2. **è¯æ˜ç”Ÿæˆå¤±è´¥**: æ£€æŸ¥è¾“å…¥æ•°æ®æ ¼å¼
3. **éªŒè¯å¤±è´¥**: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„éªŒè¯å¯†é’¥
4. **å†…å­˜ä¸è¶³**: å¢åŠ Node.jså†…å­˜é™åˆ¶

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `calculate-hash` è„šæœ¬éªŒè¯å“ˆå¸Œè®¡ç®—
2. æ£€æŸ¥ç”Ÿæˆçš„JSONæ–‡ä»¶æ ¼å¼
3. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
4. éªŒè¯æ–‡ä»¶è·¯å¾„å’Œæƒé™

## ğŸ“š å‚è€ƒèµ„æ–™

- [Poseidon2è®ºæ–‡](https://eprint.iacr.org/2023/323.pdf)
- [Circomå®˜æ–¹æ–‡æ¡£](https://docs.circom.io/)
- [SnarkJSæ–‡æ¡£](https://github.com/iden3/snarkjs)
- [é›¶çŸ¥è¯†è¯æ˜åŸºç¡€](https://zkproof.org/)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- Circomå›¢é˜Ÿæä¾›çš„ä¼˜ç§€å·¥å…·é“¾
- SnarkJSçš„Groth16å®ç°
- Poseidon2è®ºæ–‡ä½œè€…

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ã€‚ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨è¯„ä¼°ã€‚ 